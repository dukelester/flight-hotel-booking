
{% extends 'base.html' %}
{% load static %}
{% block content %}


        <div class="progress-form px-10 lg:px-24 sm:px-10 md:px-10">
            <div class="progress-bar flex w-full items-center justify-between py-8">
                <div class="flex space-x-2">

                </div>
                <hr class="bg-gray-300 h-px w-64">
                <div class="flex space-x-2">

                </div>
                <hr class="bg-gray-300 h-px w-64">
                <div class="flex space-x-2">

                </div>
            </div>
            <form name="f" action="{% url 'book' offerid  %}" method="post">{% csrf_token %}

                <div v-if="currentStep == 1" class="first">
                    <div class="details px-4">

                        <h4 class="text-xl font-bold ">Booking details</h4>
                         {% for room in roomdetailslist %}
                        <div class="flex justify-between">
                            <div class="in">
                                <h5 class="text-base font-bold">Check-in</h5>
                                <h5 class="text-base font-bold">{{ room.checkindate }}</h5>
<!--                                <p>From {{ room.checkintime }}</p>-->
                            </div>
                            <div class="out">
                                <h5 class="text-base font-bold">Check-out</h5>
                                <h5 class="text-base font-bold">{{ room.checkout }}</h5>
<!--                                <p>Until {{ room.checkouttime }}</p>-->
                            </div>
                        </div>
                        <div class="one-day flex space-x-2 mt-4 mb-2 items-center">

                        </div>

                        <div class="space-y-2 mt-8">
                            <h5 class="font-bold text-xl">Your Selection:</h5>
                            <p>{{ hotelname }}</p>
<!--                            <p class="text-blue-700">Change your selection</p>-->
                        </div>
                        <div class="space-y-2 mt-8">
                            <h5 class="font-bold text-xl">Your price summary:</h5>

                            <span class="flex justify-between mt-4">
                                <p>Base</p>
                                <h5 class="font-bold text-base">{{ room.base }}</h5>
                            </span>
                            <span class="flex justify-between mt-4">
                                <p>Tax</p>
                                <h5 class="font-bold text-base">{{ room.tax }}</h5>
                            </span>

                        </div>
                        <div class="flex justify-between mt-8">
                            <div class="block">
                                <h5 class="text-lg font-bold">Price</h5>
                                <p>(Total)</p>
                            </div>
                            <h5 class="text-xl font-bold">{{ room.currency}} {{ room.total }}</h5>
                        </div>
                          {% endfor %}
                    </div>


                    <div class="edits">
                        <div class="flex space-x-4">
                            <img src="{{ media }}" alt="" class="h-auto w-64">
                            <div class="area">
                                <h4 class="font-bold text-3xl">{{ hotelname }}</h4>
                                <div class="flex space-x-2 my-2">
                                    {% for i in ammenities %}
                                    <p class="border border-orange-500 p-1">{{i}}</p>
                                   {% endfor %}
                                </div>
                                <div class="flex items-center justify-between space-x-3">
                                    <div class="flex items-center space-x-3">
                                        <span><i class="fas fa-map-marker"></i></span>
                                        <h5 class="text-xl font-bold">{{line }}, {{cityname}} </h5>
                                    </div>

<!--                                    <a href="#" class="text-blue-500">Show on map</a>-->
                                </div>
                                <div class="checks mt-4 space-y-3">

                                    <div class="flex space-x-4 items-center">
                                        <span class="text-orange-600"><i class="fas fa-check"></i></span>
                                        <p>One of our top picks in {{cityname}}</p>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="arrival">
                            <h5 class="mt-3 text-xl font-bold">Enter your details</h5>
                            {% if request.user.is_authenticated %}
                            
                                 {% if user.profile.profile_picture   %}

                             <img src="{{ user.profile.profile_picture.url|default_if_none:'images/user.svg' }}" alt=""  class="user-img">

                                {% else %}

                            <img src="{% static 'images/user.svg' %}" alt="" style="width:40px; height:40px;"class="user-img">


                                {% endif %}

                            {% else %}

                            {% endif %}
                            <h6 class="mb-2 font-medium">Almost done! Just fill in the *required info</h6>
                        </div>
                        <div class="form-sections mt-6">
                            <div class="sect sect1 p-5 ">
                                <div class="work font-bold">
<!--                                    <h5>Are you travelling for work</h5>-->
<!--                                    <div class="flex items-center space-x-12 mt-3">-->
<!--                                        <div class="flex items-center space-x-3">-->
<!--                                            <input type="radio" value="Yes">-->
<!--                                            <h6 class="font-bold">Yes</h6>-->
<!--                                        </div>-->
<!--                                        <div class="flex items-center space-x-3">-->
<!--                                            <input type="radio" value="No">-->
<!--                                            <h6 class="font-bold">No</h6>-->
<!--                                        </div>-->
<!--                                    </div>-->
                                </div>
                                <div class="names mt-4">
                                    <div class="flex space-x-8">
                                        <div class="flex flex-col">
                                            <label class="font-bold">Title</label>
                                            <input name="title" required type="text" placeholder="Mr/Ms/Other">
                                        </div>
                                        <div class="flex flex-col">
                                            <label class="font-bold">First Name</label>
                                            <input name="FirstName" required type="text" placeholder="First Name">
                                        </div>
                                        <div class="flex flex-col">
                                            <label class="font-bold">Last Name*</label>
                                            <input name="LastName" required type="text" placeholder="Last Name">
                                        </div>
                                    </div>
                                </div>
                                <div class="email mt-4">
                                    <div class="flex flex-col">
                                        <label class="font-bold">Email Address*</label>
                                        <input name="email" required type="email" placeholder="" class=" max-w-sm">
                                    </div>
<!--                                    <p class="mt-2">Confirmation email is sent to this address</p>-->
                                    <div class="flex flex-col mt-4">
                                        <label class="font-bold">Confirm Email Address*</label>
                                        <input onblur="if(this.value!=forms.f.email.value) alert('Emails do not match!')" name="confirm_email" required type="email" placeholder="" class=" max-w-sm">
                                    </div>
                                    <div class="flex flex-col mt-4">
                                        <label class="font-bold">Phone</label>
                                        <input name="phone" required  placeholder="" class=" max-w-sm">
                                    </div>
                                </div>
                                <div class="who mt-4">

                                </div>

                            </div>
                              <div class="form-sections mt-6">
                            <div class="sect sect1 p-5 ">
                             {% for room in roomdetailslist %}
                                <div class="names mt-4">
                                    <h1>Card details</h1>
                                     <p>Accepted Payments: {% for i in room.acceptedPayments.methods %}{{ i }} {% endfor %}</p><br>

                                    <div class="flex space-x-8">



                                        <div class="flex flex-col mt-4">


                                            <label class="font-bold">Card Vendor code</label>
                                            <select  name="card_vendor_code" required id="cars">
                                                {% for i in room.acceptedPayments.creditCards %}
                                                  <option value="volvo">{{i}}</option>
                                                {% endfor %}

                                            </select>

<!--                                            <input required name="card_vendor_code" type="text" placeholder="True" class="max-w-sm" id="holder" onfocusout="validateholder()">-->
                                            <span class="helper-txt"></span>
                                        </div>


                                         <div class="flex flex-col mt-4">
                                                <label class="font-bold">Expiry Date *</label>
                                                <input required  name="expiry" onfocus="(this.type='month')" onblur="(this.type='text')" type="month" placeholder="2000" class="max-w-sm" id="expiry" onfocusout="validateexpiry()">
                                                <span class="helper-txt"></span>
                                        </div>
                                    <div class="flex flex-col mt-4">
                                        <label class="font-bold">Card Number *</label>
                                        <input required  name="card_number"  type="text" placeholder="123-897-5654-90" class="max-w-sm" id="cardno" onfocusout="validatecardno()">
                                        <span class="helper-txt"></span>
                                    </div>








                                    </div>
                                </div>
                                 {% endfor %}
                            </div>
                            <div class="sect sect3 p-5 mt-5">

                                <p class="mt-2">You can always make a special request after your booking is complete!</p>
                                <textarea cols="50" rows="4" class="max-w-xl mt-4"></textarea>


                                <h5 class="text-lg font-bold mb-4">Let the property know when you plan to arrive.</h5>
                                <p>You might hear back from the property about your arrival time.</p>

                                <p class="mt-4">For a warm welcome and a smooth check-in, let your host know your expected arrival time in advance. You can do that here or contact them directly using the details provided in your confirmation.</p>
                                <div class="flex flex-col items-end">

                                        <input name="hoteldetails" type="hidden" value="{{ hoteldetails }}">
                                        <input name="roomdetails" type="hidden" value="{%for i in roomdetailslist %} {{i}} {% endfor %}">

                                    <button type="submit" class="py-4 px-8 text-white flex space-x-2">
                                        <p>Complete Booking</p>
                                        <span><i class="fas fa-arrow-right"></i></span>-->
                                    </button>
                                    <p class="mt-2">An email will be sent to you with the booking details</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="currentStep == 3">3</div>
            </form>
        </div>


    <script>
        new Vue({
            el: '#app',
            data: {
                currentStep: 1,
                tb1complete: false,
                tb2complete: false,
                tb3complete: false
            },
            methods: {
                goToStep2: function() {
                    this.currentStep = 2;
                    this.tb1complete = true
                },
                goToStep3: function() {
                    this.currentStep = 3;
                    this.tb2complete = true
                },
                prevStep: function() {
                    this.currentStep = this.currentStep-1
                }
            },
        });
    </script>
    <script>
        //Input fields
        const firstName = document.getElementById("first");
        const lastName = document.getElementById("last");
        const email = document.getElementById("email");
        const confirmemail = document.getElementById("confirmemail");
        const countrycode = document.getElementById("countrycode");
        const phone = document.getElementById("phone");
        const device = document.getElementById("device");
        const doctype = document.getElementById("doctype");
        const birthPlace = document.getElementById("birthplace");
        const issuePlace = document.getElementById("issueplace");
        const issueDate = document.getElementById("issuedate");
        const expiry = document.getElementById("expiry");
        const cardNo = document.getElementById("cardno");
        const issueCountry = document.getElementById("issuecountry");
        const validityCountry = document.getElementById("validitycountry");
        const nationality = document.getElementById("nationality");
        const holder = document.getElementById("holder");
        //Form
        const form = document.getElementById("flightCheckoutForm");
        //Validation colors
        const red = '#F44336';
        const green = '#4CAF50';

        /*Handle form submission
        form.addEventListener("submit", function(e) {
            e.preventDefault();
        }) */


        //Input Field validation Functions

        function validateFirstName() {
            if(checkIfEmpty(firstName)) return;
            if(!checkIfOnlyLetters(firstName)) return;
            return true;
        }
        function validateLastName() {
            if(checkIfEmpty(lastName)) return;
            if(!checkIfOnlyLetters(lastName)) return;
            return true;
        }
        function validateEmail() {
            if(checkIfEmpty(email)) return;
            if (/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(email.value)) {
                setValid(email);
            } else {
                setInvalid(email, `Email must have prorper format.`);
            }
            return true;
        }
        function validateConfirmEmail() {
            if(checkIfEmpty(confirmemail)) return;
            if (/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(email.value)) {
                setValid(email);
            } else {
                setInvalid(email, `Email must have prorper format.`);
            }
            //see if passwords match
            if(email.value !== confirmemail.value) {
                setInvalid(confirmemail, `Both emails must match`);
                return;
            }
            else {
                setValid(confirmemail);
            }
            return true;
        }

        function validatecountrycode() {
            if(checkIfEmpty(countrycode)) return;
        }
        function validatephone() {
            if(checkIfEmpty(phone)) return;
        }
        function validatedevice() {
            if(checkIfEmpty(device)) return;
        }
        function validatedoctype() {
            if(checkIfEmpty(doctype)) return;
        }
        function validatebirthplace() {
            if(checkIfEmpty(birthPlace)) return;
        }
        function validateissueplace() {
            if(checkIfEmpty(issuePlace)) return;
        }
        function validateissuedate() {
            if(checkIfEmpty(issueDate)) return;
        }

        function validateexpiry() {
            if(checkIfEmpty(expiry)) return;
        }
        function validatecardno() {
            if(checkIfEmpty(cardNo)) return;
            var cardreg = /^(?:4[0-9]{12}(?:[0-9]{3})?)$/;
            if(cardNo.value.match(cardreg)) {
                setValid(cardNo);
            } else {
                setInvalid(cardNo, `Not a valid  credit card number!`);
            }
        }
        function validateissuecountry() {
            if(checkIfEmpty(issueCountry)) return;
        }
        function validatevaliditycountry() {
            if(checkIfEmpty(validityCountry)) return;
        }

        function validatenationality() {
            if(checkIfEmpty(nationality)) return;
        }
        function validateholder() {
            if(checkIfEmpty(holder)) return;
        }
        //Utility functions

        function checkIfEmpty(field) {
            if(isEmpty(field.value.trim())) {
                setInvalid(field, `Field must not be empty.`);
                return true;
            } else {
                setValid(field);
                return false;
            }
        }
        function checkIfOnlyLetters(field) {
            if(/^[a-zA-Z ]+$/.test(field.value)) {
                setValid(field);
                return true;
            } else {
                setInvalid(field, `${field.name} must only contain letters.`);
                return false;
            }
        }
        function isEmpty(value) {
            if(value === '') return true;
            return false;
        }
        function setInvalid(field, message) {
            field.className = 'invalid';
            field.nextElementSibling.innerHTML = message;
            field.nextElementSibling.style.color = red;
        }
        function setValid(field) {
            field.className = 'valid';
            field.nextElementSibling.innerHTML = '';
            //field.nextElementSibling.style.color = green;
        }

    </script>

    <script src="{% static 'index.js' %}"></script>
<!--</body>-->
<!--</html>-->

{% endblock %}
